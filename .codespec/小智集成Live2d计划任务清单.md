# 小智集成Live2d计划任务清单

## 1. 项目现状分析

### 当前页面结构
1. **ChatPage** - 主聊天页面:
   - 包含消息历史记录的滚动列表
   - 底部有"按住说话"按钮用于语音输入
   - 右上角有通话按钮，跳转到通话页面
   - 左上角有设置按钮，跳转到设置页面

2. **CallPage** - 通话页面:
   - 显示一个渐变色圆形区域（目前使用的是AnimatedMeshGradient）
   - 展示最新的消息文本
   - 有一个挂断电话的红色按钮

3. **SettingPage** - 设置页面:
   - 提供OTA URL、WebSocket URL和MAC地址的设置选项

## 2. Live2D集成计划

### 第一阶段：创建基础组件和集成
- [ ] 创建Live2D显示组件
  - [ ] 创建一个专门的Flutter Widget来承载Android端的Live2D视图
  - [ ] 实现MethodChannel通信机制
- [ ] 在通话页面集成Live2D模型
  - [ ] 替换现有的AnimatedMeshGradient组件为Live2D显示组件
  - [ ] 添加触摸交互功能

### 第二阶段：扩展集成范围
- [ ] 在聊天页面添加模型预览
  - [ ] 在消息列表上方添加一个小尺寸的Live2D模型预览
  - [ ] 点击可跳转到通话页面
- [ ] 实现基础模型控制功能
  - [ ] 根据消息内容触发相应表情
  - [ ] 实现简单的动作播放控制

### 第三阶段：高级功能实现
- [ ] 实现口型同步
  - [ ] 在语音播放时，根据语音内容驱动模型口型变化
  - [ ] 实现音频输入检测和分析
  - [ ] 将音频特征参数传递给Live2D模型
- [ ] 实现更多交互功能
  - [ ] 根据用户触摸位置产生相应反应
  - [ ] 实现场景切换功能

## 3. 技术实现要点

### 组件设计
1. 创建独立的Live2D显示组件，确保可复用性
2. 通过MethodChannel实现Flutter与Android原生代码通信
3. 在Android端使用GLSurfaceView渲染Live2D模型

### 集成策略
1. 优先在通话页面集成完整功能的Live2D模型
2. 再扩展到聊天页面的小尺寸预览
3. 最后实现复杂的口型同步和交互功能

### 注意事项
1. 确保Live2D SDK正确集成到项目中
2. 正确配置OpenGL ES环境
3. 处理好Flutter与Android原生代码的生命周期管理
4. 实现高效的内存管理和资源释放机制