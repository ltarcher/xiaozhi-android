# 语音唤醒功能测试指南

## 功能概述
本项目已集成Vosk语音识别引擎，实现了本地唤醒词唤醒连续对话功能。
- 默认唤醒词："你好，小清"
- 用户可以在设置页面自定义唤醒词
- 支持中文语音识别和唤醒词检测

## 测试步骤

### 1. 安装并启动应用
```bash
flutter run
```

### 2. 进入聊天页面
- 在主界面点击聊天图标进入聊天页面

### 3. 配置唤醒词（可选）
- 点击右上角设置按钮进入设置页面
- 找到"唤醒词设置"选项
- 可以修改默认唤醒词"你好，小清"
- 保存设置

### 4. 启用语音唤醒
- 在聊天页面，语音唤醒功能会自动初始化
- 检查聊天页面顶部是否有"语音唤醒已启用"提示

### 5. 测试唤醒
- 对着手机说唤醒词（默认："你好，小清"）
- 唤醒成功后，应用会自动激活语音输入状态
- 可以直接开始说话进行对话

### 6. 连续对话测试
- 唤醒后可以进行连续对话
- 对话结束后，系统会重新进入待机状态
- 可以再次使用唤醒词激活

## 技术实现

### 文件结构
- `android/app/src/main/java/com/thinkerror/xiaozhi/VoiceWakeUpService.java` - Android原生语音唤醒服务
- `lib/util/voice_wake_up_service.dart` - Flutter端语音唤醒服务接口
- `lib/page/chat_page.dart` - 集成语音唤醒功能的聊天页面
- `lib/page/setting_page.dart` - 唤醒词配置页面

### 关键技术点
1. 使用Vosk语音识别引擎进行本地语音识别
2. 使用Flutter MethodChannel实现原生与Flutter端通信
3. 使用SharedPreferences存储用户自定义唤醒词
4. 实现实时音频流处理和唤醒词检测

## 可能的问题与解决方案

### 模型加载失败
如果出现模型加载失败的错误：
1. 检查assets/vosk/models/vosk-model-small-cn-0.22目录是否存在
2. 确保模型文件完整
3. 重新编译安装应用

### 唤醒不灵敏
如果唤醒词识别不灵敏：
1. 检查是否授予了麦克风权限
2. 确保环境噪音较小
3. 尝试更清晰地发音
4. 可以在设置页面修改更简单的唤醒词

### 无法连续对话
如果无法进行连续对话：
1. 检查语音输入功能是否正常
2. 确保网络连接正常
3. 检查语音识别引擎是否正确初始化